global:
  scrape_interval: 30s # By default, scrape targets every 15 seconds.

  # Attach these labels to any time series or alerts when communicating with
  # external systems (federation, remote storage, Alertmanager).
  external_labels:
    monitor: 'Idrica-monitor'

rule_files:
    - 'alert.rules.yml'

alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - 'alertmanager:9093'

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:

# #############################################
# DevOps
# #############################################

  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
  - job_name: 'prometheus'
    # Override the global default and scrape targets from this job every 5 seconds.
    scrape_interval: 30s
    static_configs:
      - targets: [
      'localhost:9090'
      ]
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'Grafana_Devops'
    # Override the global default and scrape targets from this job every 5 seconds.
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.97:3000'
      ]
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'alertmanager'
    scrape_interval: 30s
    static_configs:
      - targets: [
      'alertmanager:9093'
      ]
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'Logstash_exporter_DevOps'
    scrape_interval: 30s
    static_configs:
      - targets: ['192.168.3.131:9304','192.168.3.132:9304']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment


  - job_name: 'node_exporter-devops'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.96:9100',
      '192.168.3.97:9100',
      '192.168.3.98:9100',
      '192.168.3.99:9100',
      '192.168.2.238:9100',
      '192.168.3.95:9100',
      '192.168.3.48:9100',
      '192.168.3.167:9100',
      '192.168.3.168:9100',
      '192.168.3.132:9100',
      '192.168.3.131:9100'
      #'192.168.3.17:9100' Solo se activa si es necesario
      ]
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'jenkins'
    scrape_interval: 30s
    metrics_path: /prometheus
    scheme: https
    tls_config:
      insecure_skip_verify: true 
    static_configs:
      - targets: [ 'jenkins.dev.idrica.pro' ]
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'Nexus_Devops'
    scrape_interval: 30s
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets: [ 'nexus-exporter.dev.idrica.pro']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'gitlab_metrics'
    scrape_interval: 30s
    static_configs:
      - targets: ['192.168.3.99:9168']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'gitlab-process'
    scrape_interval: 30s
    metrics_path: /process
    static_configs:
      - targets: ['192.168.3.99:9168']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'gitlab-sidekiq'
    scrape_interval: 30s
    metrics_path: /sidekiq
    static_configs:
      - targets: ['192.168.3.99:9168']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'docker-devops'
         # metrics_path defaults to '/metrics'
         # scheme defaults to 'http'.
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.97:9323',
      '192.168.3.98:9323',
      '192.168.2.238:9323',
      '192.168.3.48:9323'
      ]
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'Zipkin_Devops'
    scrape_interval: 30s
    metrics_path: '/prometheus'
    static_configs:
      - targets: [
      '192.168.3.97:9411'
      #'zipkin.dev.idrica.pro'
      ]
    metric_relabel_configs:
      # Response code count
      - source_labels: [__name__]
        regex: '^status_(\d+)_(.*)$'
        replacement: '${1}'
        target_label: status
      - source_labels: [__name__]
        regex: '^status_(\d+)_(.*)$'
        replacement: '${2}'
        target_label: path
      - source_labels: [__name__]
        regex: '^status_(\d+)_(.*)$'
        replacement: 'http_requests_total'
        target_label: __name__
      # Response time, pending histogram from https://github.com/openzipkin/zipkin/pull/1609
      - source_labels: [__name__]
        regex: '^response_(.*)$'
        replacement: '${1}'
        target_label: path
      - source_labels: [__name__]
        regex: '^response_(.*)$'
        replacement: 'http_request_duration_milliseconds'
        target_label: __name__
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'elastic_exporter-devops'
    scrape_interval: 30s
    static_configs:
      - targets: ['192.168.3.131:9108']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'nifi_devops'
    scrape_interval: 30s
    static_configs:
      - targets: ['192.168.3.135:9092']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'grafana-image-rendering-service'
    static_configs:
      - targets: ['192.168.3.97:18081']
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'SonarQube_Devops'
    scrape_interval: 30s
    static_configs:
      - targets: ['sonarqube:9000']
    metrics_path: '/api/prometheus/metrics'
    relabel_configs:
      - replacement: 'DevOps'
        target_label: environment

  - job_name: 'traefik-devops'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ 'swarm-ci-cd.dev.idrica.pro:8080' ]

# #############################################
# PRE
# #############################################
  - job_name: 'node_exporter-pre'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.135:9100',
      '192.168.3.139:9100',
      '192.168.3.93:9100',
      '192.168.2.18:9100',
      '192.168.2.19:9100',
      '192.168.3.94:9100',
      '192.168.2.176:9100',
      '192.168.2.201:9100'
      ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'node_exporter-pre-db'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.150:9100'           
      ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'postgresql-pre'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.150:9187'
      ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'docker-pre'
         # metrics_path defaults to '/metrics'
         # scheme defaults to 'http'.
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.131:9323',
      '192.168.3.132:9323',
      '192.168.3.139:9323',
      '192.168.3.93:9323',
      '192.168.2.18:9323',
      '192.168.2.19:9323',
      '192.168.2.176:9323',
      '192.168.2.201:9323'
      ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'discover-services-pre'
    scrape_interval: 30s
    metrics_path: /actuator/prometheus
    scheme: https
    consul_sd_configs:
      - server: discover-server.dev.idrica.pro
        datacenter: default
    relabel_configs:
      - replacement: 'gateway-proxy.dev.idrica.pro'
        target_label:  __address__
      - replacement: 'PRE'
        target_label: environment
      - source_labels: [ '__meta_consul_service_id' ]
        action: replace
        regex: (.*):(.*):(.*)
        replacement: $2
        target_label: container_name
      - source_labels: [ container_name ]
        target_label: __metrics_path__
        replacement: '/${1}/actuator/prometheus/'

  - job_name: 'Kafka_Pre'
    scrape_interval: 30s
    static_configs:
      - targets: ['swarm-pre.dev.idrica.pro:7071']
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'nifi_pre'
    scrape_interval: 30s
    static_configs:
      - targets: ['swarm-pre.dev.idrica.pro:19092']
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: mongodb-pre
    scrape_interval: 30s
    metrics_path: /metrics
    static_configs:
      - targets: ['swarm-pre.dev.idrica.pro:9216']
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'flink_pre'
    scrape_interval: 30s
    static_configs:
      - targets: ['swarm-pre.dev.idrica.pro:9249','swarm-pre.dev.idrica.pro:9250','swarm-pre.dev.idrica.pro:9251']
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'Elastic_pre'
    scrape_interval: 30s
    static_configs:
      - targets: ['swarm-pre.dev.idrica.pro:9108']
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  #- job_name: 'druid_exporter'
  #  scrape_interval: 30s
  #  static_configs:
  #    - targets: ['192.168.3.48:9090']
  #  relabel_configs:
  #    - replacement: 'PRE'
  #      target_label: environment

  #- job_name: 'eventstore_pre'
  #  scrape_interval: 30s
  #  static_configs:
  #    - targets: ['swarm-pre.dev.idrica.pro:9448']
  #  relabel_configs:
  #    - replacement: 'PRE'
  #      target_label: environment

  #- job_name: zookeeper_exporter_pre
  #  static_configs:
  #    - targets: ['swarm-pre.dev.idrica.pro:7070']
  #  relabel_configs:
  #    - replacement: 'PRE'
  #      target_label: environment

  #- job_name: clickhouse_pre
  #  static_configs:
  #  - targets: ['192.168.3.48:8001']
  #  relabel_configs:
  #    - replacement: 'PRE'
  #      target_label: environment

  - job_name: 'windows-pre'
    scrape_interval: 30s
    static_configs:
            - targets: [
            '192.168.2.43:9182'
            ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'cadvisor-pre'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.131:18888',
      '192.168.3.132:18888',
      '192.168.3.93:18888',
      '192.168.2.18:18888',
      '192.168.2.19:18888',
      '192.168.2.176:18888',
      '192.168.2.201:18888'
      ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'prometheus-logstash_exporter-pre'
    scrape_interval: 30s
    static_configs:
      - targets: ['swarm-pre.dev.idrica.pro:9304']
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'mysql-pre'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.2.90:9104'
      ]
    relabel_configs:
      - replacement: 'PRE'
        target_label: environment

  - job_name: 'traefik-PRE'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ 'swarm-pre.dev.idrica.pro:8080' ]


# #############################################
# QA
# #############################################

  - job_name: 'node_exporter-qa'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.45:9100',
      '192.168.3.213:9100',
      '192.168.3.214:9100',
      '192.168.3.216:9100',
      '192.168.3.189:9100'            
      ]
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'node_exporter-qa-db'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.145:9100'
      ]
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'postgresql-qa' 
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.145:9187'
      ]
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'discover-services-qa'
    scrape_interval: 30s
    metrics_path: /actuator/prometheus
    scheme: http
    consul_sd_configs:
      - server: goaigua-swarm-qa.globalomnium.com:8761
        datacenter: default
    relabel_configs:
      - replacement: 'goaigua-swarm-qa.globalomnium.com:9083'
        target_label:  __address__
      - replacement: 'QA'
        target_label: environment
      - source_labels: [ '__meta_consul_service_id' ]
        action: replace
        regex: (.*):(.*):(.*)
        replacement: $2
        target_label: container_name
      - source_labels: [ container_name ]
        target_label: __metrics_path__
        replacement: '/${1}/actuator/prometheus/'

  - job_name: 'docker-qa'
         # metrics_path defaults to '/metrics'
         # scheme defaults to 'http'.
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.45:9323',
      '192.168.3.213:9323',
      '192.168.3.214:9323',
      '192.168.3.216:9323'
      ]
      
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'kafka-qa'
    scrape_interval: 30s
    static_configs:
      - targets: ['goaigua-swarm-qa.globalomnium.com:7071']
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: mongodb-qa
    scrape_interval: 30s
    metrics_path: /metrics
    static_configs:
      - targets: ['goaigua-swarm-qa.globalomnium.com:9216']
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'flink_qa'
    scrape_interval: 30s
    static_configs:
      - targets: ['goaigua-swarm-qa.globalomnium.com:9249','goaigua-swarm-qa.globalomnium.com:9250','goaigua-swarm-qa.globalomnium.com:9251']
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'elastic_exporter_qa'
    scrape_interval: 30s
    static_configs:
      - targets: ['goaigua-swarm-qa.globalomnium.com:9108']
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

#  - job_name: zookeeper_exporter_qa
#    static_configs:
#      - targets: ['goaigua-swarm-qa.globalomnium.com:7070']
#    relabel_configs:
#      - replacement: 'QA'
#        target_label: environment

  - job_name: 'cadvisor-qa'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.3.213:18888',
      '192.168.3.214:18888',
      '192.168.3.216:18888'
      ]
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'prometheus-logstash_exporter-qa'
    scrape_interval: 30s
    static_configs:
      - targets: ['goaigua-swarm-qa.globalomnium.com:9304']
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'windows-qa'
    scrape_interval: 30s
    static_configs:
            - targets: [
            '192.168.2.43:9182'
            ]
    relabel_configs:
      - replacement: 'QA'
        target_label: environment

  - job_name: 'traefik-QA'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ 'goaigua-swarm-qa.globalomnium.com:8080' ]       

# #############################################
# DEMO
# #############################################

  - job_name: 'node_exporter-demo'
    scrape_interval: 30s
    static_configs:
      - targets: [
      #'172.31.48.5:9100', APAGADA
      '172.31.48.6:9100',
      #'172.31.48.7:9100', APAGADA
      #'172.31.48.10:9100', APAGADA
      '172.31.48.8:9100',
      '172.31.48.11:9100',
      '172.31.48.205:9100'
      ]
    relabel_configs:
      - replacement: 'Demo'
        target_label: environment

  - job_name: 'node_exporter-demo-db'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '172.31.48.9:9100'           
      ]
    relabel_configs:
      - replacement: 'Demo'
        target_label: environment

  - job_name: 'postgresql-demo'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '172.31.48.9:9187'
      ]
    relabel_configs:
      - replacement: 'Demo'
        target_label: environment

  - job_name: 'discover-services-demo'
    scrape_interval: 30s
    metrics_path: /actuator/prometheus
    scheme: http
    consul_sd_configs:
      - server: 172.31.48.6:8761
        datacenter: default
    relabel_configs:
      - replacement: '172.31.48.6:9083'
        target_label:  __address__
      - replacement: 'Demo'
        target_label: environment
      - source_labels: [ '__meta_consul_service_id' ]
        action: replace
        regex: (.*):(.*):(.*)
        replacement: $2
        target_label: container_name
      - source_labels: [ container_name ]
        target_label: __metrics_path__
        replacement: '/${1}/actuator/prometheus/'

  - job_name: 'windows-demo'
    scrape_interval: 30s
    static_configs:
            - targets: [
            '172.31.48.204:9182'
            ]
    relabel_configs:
      - replacement: 'Demo'
        target_label: environment

  - job_name: 'traefik-Demo'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ 'swarm-dm.go-aigua.com:8080' ]


# #############################################
# PRO
# #############################################

  - job_name: 'node_exporter-pro'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.2.216:9100',
      '192.168.2.217:9100',
      '192.168.2.218:9100',
      '192.168.2.29:9100',
      '192.168.3.21:9100',
      '192.168.3.22:9100',
      '192.168.3.25:9100'

      ]
    relabel_configs:
      - replacement: 'Pro'
        target_label: environment

  - job_name: 'nifi-Pro'
    scrape_interval: 30s
    static_configs:
      - targets: [
        '192.168.2.216:9092',
        '192.168.2.217:9092'
      ]
    relabel_configs:
      - replacement: 'Pro'
        target_label: environment

  - job_name: 'discover-services-pro'
    scrape_interval: 30s
    metrics_path: /actuator/prometheus
    scheme: http
    consul_sd_configs:
      - server: goaigua-swarm-pro.globalomnium.com:8761
        datacenter: default
    relabel_configs:
      - replacement: 'goaigua-swarm-pro.globalomnium.com:9083'
        target_label:  __address__
      - replacement: 'Pro'
        target_label: environment
      - source_labels: [ '__meta_consul_service_id' ]
        action: replace
        regex: (.*):(.*):(.*)
        replacement: $2
        target_label: container_name
      - source_labels: [ container_name ]
        target_label: __metrics_path__
        replacement: '/${1}/actuator/prometheus/'        

  - job_name: 'traefik-Pro'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ 'goaigua-swarm-pro.globalomnium.com:8080' ]


# #############################################
# GO-SWARM (Tirio OFF)
# #############################################

  - job_name: 'node_exporter-tirio'
    scrape_interval: 30s
    static_configs:
      - targets: [
      '192.168.2.242:9100',
      '192.168.3.163:9100',
      '192.168.3.183:9100'
      ]
    relabel_configs:
      - replacement: 'Tirio-OFF'
        target_label: environment 

###################################################
################### Dev-Cloud ###################
###################################################

  - job_name: 'node_exporter-Dev-Cloud'
    scrape_interval: 15s
    static_configs:
      - targets: [
        '52.157.70.87:9100',
        '51.137.124.85:9100',
        '51.137.124.84:9100',
        '52.137.5.220:9100',
        '51.145.193.131:9100',
        '13.81.50.1:9100'
      ]
    relabel_configs:
      - replacement: 'Dev-Cloud'
        target_label: environment

  - job_name: 'nexus-windows-Dev-Cloud'
    scrape_interval: 30s
    static_configs:
      - targets: [
        '51.137.124.61:9182'
      ]
    relabel_configs:
      - replacement: 'Dev-Cloud'
        target_label: environment

  - job_name: 'discover-services-dev-cloud'
    scrape_interval: 30s
    metrics_path: /actuator/prometheus
    scheme: http
    consul_sd_configs:
      - server: 51.137.124.84:8761
        datacenter: default
    relabel_configs:
      - replacement: '51.137.124.84:9083'
        target_label:  __address__
      - replacement: 'Dev-Cloud'
        target_label: environment
      - source_labels: [ '__meta_consul_service_id' ]
        action: replace
        regex: (.*):(.*):(.*)
        replacement: $2
        target_label: container_name
      - source_labels: [ container_name ]
        target_label: __metrics_path__
        replacement: '/${1}/actuator/prometheus/'

  - job_name: 'traefik-Dev-Cloud'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ '51.137.124.84:8080' ]



###################################################
################### Servicios #####################
###################################################

  - job_name: 'node_exporter-Servicios'
    scrape_interval: 15s
    static_configs:
      - targets: [
        '192.168.2.82:9100',
        '192.168.2.209:9100',
        '192.168.3.72:9100',
        '192.168.2.214:9100',
        '192.168.2.213:9100',
        '192.168.3.128:9100',
        '192.168.3.164:9100'
      ]
    relabel_configs:
      - replacement: 'Servicios'
        target_label: environment

  - job_name: 'traefik-Servicios'
    # If the entrypoint is HTTPS
    scheme: http
    static_configs:
      - targets: [ 
        '192.168.2.82:8080',
        '192.168.2.209:8080',
        '192.168.3.72:8080'
      ]

  - job_name: 'nifi_Servicios'
    scrape_interval: 30s
    static_configs:
      - targets: [
        '192.168.3.128:9092',
        '192.168.3.164:9092'
      ]
    relabel_configs:
      - replacement: 'Servicios'
        target_label: environment


  - job_name: 'discover-services-Servicios'
    scrape_interval: 30s
    metrics_path: /actuator/prometheus
    scheme: http
    consul_sd_configs:
      - server: 192.168.2.82:8761
        datacenter: default
    relabel_configs:
      - replacement: '192.168.2.82:9083'
        target_label:  __address__
      - replacement: 'Servicios'
        target_label: environment
      - source_labels: [ '__meta_consul_service_id' ]
        action: replace
        regex: (.*):(.*):(.*)
        replacement: $2
        target_label: container_name
      - source_labels: [ container_name ]
        target_label: __metrics_path__
        replacement: '/${1}/actuator/prometheus/'




###############################################################
################## LOCAL JAVI ########### #####################
###############################################################

  - job_name: 'node_exporter-local-javier'
    scrape_interval: 15s
    static_configs:
      - targets: [
        '192.168.33.190:9101',
        '192.168.33.190:7001',
        '172.16.86.21:9101',
        '172.16.86.21:7001'

      ]
    relabel_configs:
      - replacement: 'Pruebas-Soporte'
        target_label: environment

